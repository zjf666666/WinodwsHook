## 一、背景

        HookEngine类作为调用Hook的接口类，需要负责接收调用方的参数，在内部组装好，传给具体的Hook。

## 二、问题

        不同的Hook类型参数完全不同，例如windows事件hook、消息hook、IAThook。这里的设计需要满足以下条件

        1.  外部业务不负责组装，这不是业务该关心的事，业务只负责传参数

2. HookEngine负责组装数据+实现方法，但是应该与具体数据类和实现类解耦，避免影响扩展性

## 三、分析

### 方案一：

        条件1，写一个参数类，包含所有HOOK需要的参数，调用方、接收方都使用这个类

        条件2，抽象一个数据基类和一个方法基类，使用工厂模式创建。HookEngine依赖两个基类，将参数传入数据工厂，用基类指针接收数据子类，同理创建方法子类，再将数据子类传给方法子类即可。

        优点：实现简单

        缺点：随着HOOK类型增多，这个类会不断膨胀，需要清晰的注释来说明每个参数的含义；业务方在调用时，能根据这个类获取一定的实现细节；数据工厂在创建数据子类的时候也要把这个参数类全部传入，然后将自己需要的内容取出后返回。

### 方案二：

        条件1，参考C++17新引入的variant类型安全联合体，写一个参数类，这个参数类有一个私有成员变量std::map<std::string, std::pair<TypeId, void*>>，其中key表示变量名称，如pid、path、name等；TypeId表示数据类型，使用模板类的特性生成，不同类型会有不同的值，但是相同类型的值都是一样的；void*接收所有类型的参数，记录key对应的值。调用方、接收方都使用这个类

        条件2，方法类与方案一一样，采用抽象类+工厂模式的方法。数据类直接复用参数类即可，在内部根据自己需要的数据名称取出对应的值即可

        优点：按需传入，数据细节完全隐藏，扩展性极好

        缺点：需要人为约定键值名称；引入了模板类编程，代码可读性会下降，且实现难度增加；依赖这个类的文件很多，一旦修改，需要跟着改动的地方会很多。